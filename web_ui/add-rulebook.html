<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rulebooks - TTRPG Assistant</title>
    <link rel="stylesheet" href="/ui/static/style.css">
</head>
<body>
    <nav>
        <a href="/ui/">Home</a>
        <a href="/ui/search">Search</a>
        <a href="/ui/campaign">Campaign</a>
        <a href="/ui/rulebooks">Rulebooks</a>
        <a href="/ui/session">Session</a>
        <a href="/ui/personality">Personality</a>
    </nav>
    <main>
        <h1>üìö Rulebook Management</h1>
        <p class="welcome-text">Manage your PDF rulebooks - view existing ones with statistics or add new ones with AI-powered content extraction and adaptive pattern learning.</p>
        
        <!-- Existing Rulebooks Section -->
        <section class="rulebooks-list-section">
            <h2>üìñ Your Rulebooks</h2>
            <div id="rulebooks-list" class="rulebooks-container">
                <p>Loading rulebooks...</p>
            </div>
        </section>
        
        <!-- Add New Rulebook Section -->
        <section class="add-rulebook-section">
            <h2>‚ûï Add New Rulebook</h2>
        
        <form id="add-rulebook-form">
            <h3>Rulebook Information</h3>
            <input type="text" id="pdf-path" placeholder="Path to PDF file (e.g., /path/to/players-handbook.pdf)" required>
            <input type="text" id="rulebook-name" placeholder="Rulebook Name (e.g., Player's Handbook)" required>
            <input type="text" id="system" placeholder="Game System (e.g., D&D 5e, Call of Cthulhu)" required>
            <button type="submit">üìö Add Rulebook</button>
        </form>
        </section>
        
        <div class="status-section">
            <h2>Processing Notes</h2>
            <div class="status-healthy">
                <p><strong>üìã What happens when you add a rulebook:</strong></p>
                <ul style="text-align: left; margin: 1em 0;">
                    <li>PDF content is extracted and processed</li>
                    <li>Text is chunked into searchable segments</li>
                    <li>Semantic embeddings are generated for AI search</li>
                    <li>System personality is extracted and analyzed</li>
                    <li>Content is indexed for fast retrieval</li>
                </ul>
                <p><em>This process may take several minutes depending on PDF size.</em></p>
            </div>
        </div>
        
        <div id="add-results"></div>
    </main>
    
    <script src="/ui/static/script.js"></script>
    <script>
        // Load rulebooks list when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            await loadRulebooks();
        });

        async function loadRulebooks() {
            const rulebooksContainer = document.getElementById('rulebooks-list');
            rulebooksContainer.innerHTML = '<p>Loading rulebooks...</p>';
            
            try {
                const response = await fetch('/ui/api/list-rulebooks');
                if (!response.ok) throw new Error('Failed to fetch rulebooks');
                
                const data = await response.json();
                
                if (data.rulebooks && data.rulebooks.length > 0) {
                    let html = `<div class="rulebooks-summary">
                        <p><strong>${data.total_count} rulebook${data.total_count !== 1 ? 's' : ''} available</strong></p>
                    </div>
                    <div class="rulebooks-grid">`;
                    
                    data.rulebooks.forEach(rulebook => {
                        html += `
                        <div class="rulebook-card">
                            <h3>üìñ ${rulebook.name}</h3>
                            <div class="rulebook-stats">
                                <p><strong>System:</strong> ${rulebook.system}</p>
                                <p><strong>Documents:</strong> ${rulebook.document_count} chunks</p>
                                <p><strong>Collection:</strong> ${rulebook.collection}</p>
                            </div>
                        </div>`;
                    });
                    
                    html += '</div>';
                    rulebooksContainer.innerHTML = html;
                } else {
                    rulebooksContainer.innerHTML = `
                        <div class="no-rulebooks">
                            <p>üîç No rulebooks found yet!</p>
                            <p>Add your first rulebook using the form below to get started.</p>
                        </div>`;
                }
            } catch (error) {
                console.error('Error loading rulebooks:', error);
                rulebooksContainer.innerHTML = `
                    <div class="error-message">
                        <p>‚ùå Failed to load rulebooks: ${error.message}</p>
                        <button onclick="loadRulebooks()">üîÑ Retry</button>
                    </div>`;
            }
        }
    </script>
</body>
</html>